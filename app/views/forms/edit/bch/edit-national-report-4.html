<div ng-controller="editBchNationalReport4">
    <div ng-include="'/app/views/forms/edit/edit_header.html'"></div>
    <style>
        .disabled {
            -moz-opacity:.50;filter:alpha(opacity=50);opacity:.50;
        }
        .inverted.dimmer {
            background-color: rgba(255, 255, 255, .85);
        }
    </style>
    <div style="padding: 24px;background-color:#FFF;;border-bottom:2px solid #ccc;">

        <span block-region activate="isLoading()" ng-if="isLoading()"></span>
        <div class="registerpage-content" style="padding-bottom:30px;">

                <!-- <view-bch-national-report-4 ng-model="document" locale="review.locale" allow-drafts="true"></view-bch-national-report-4> -->
            <workflow-arrow-buttons document="getCleanDocument()" languages="document.header.languages" hide-timer="false"
                tab="tab" validation-report="validationReport" on-post-close="onPostClose()" on-error="onError(error, errorCode)">
                <edit-form>
                    <div class="row">
                        <div class="col-xs-12">
                            <ul class="pagination" id="nrTabs">
                                <li ng-repeat="tab in nr4Tabs" ng-class="{'active': $index==0}" ng-click="setTab($index)">
                                    <a translation-url href="#tab{{$index+1}}" data-toggle="tab" ng-bind="tab.title"></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <form class="editForm" name="editForm" style="margin-top:10px">
                        <div>
                            <legend name="formInfo" style="display:none"></legend>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="tab-content">

                                        <div class="tab-pane" ng-repeat="tab in nr4Tabs" id="tab{{$index+1}}" ng-class="{'active': $index==0}" >
                                            <!-- ng-if="activeTab==$index+1" -->
                                            <div style="margin-bottom:20px;">

                                                <div class="section-pane panel panel-default" ng-repeat="section in tab.sections"
                                                    id="section{{$index+1}}" style="margin-bottom:3px!important">

                                                    <div class="panel-heading" ng-bind="section.title"></div>
                                                    <div class="panel-body" style="padding:0px">

                                                        <div ng-repeat="question in section.questions" style="border:1px solid #eee;margin:5px"
                                                            class="row" ng-class="{'disabled': question.disabled}" ng-if="question.visible" >

                                                            <div class="col-md-12" style="padding:10px;position: relative;" block-region activate="question.disabled" skip-loading-icon="true">

                                                                <div class="col-md-12" style="padding-left:0px;padding-right: 0px;">
                                                                    <strong>
                                                                        <label name="{{question.key}}" for="{{question.key}}"
                                                                             ng-bind="::spaceSubQuestion(question.number) + question.title" ng-required="question.mandatory"></l>
                                                                    </strong>
                                                                    <div class="pull-right" style="margin-bottom:5px;">
                                                                        <button ng-if="previousAnswerMapping[question.key] && !question.showPrevious" ng-click="question.showPrevious = !question.showPrevious" class="btn btn-primary btn-xs">Show previous Answer</button>
                                                                        <button ng-if="previousAnswerMapping[question.key] && question.showPrevious"  ng-click="question.showPrevious = !question.showPrevious" class="btn btn-primary btn-xs">Hide previous Answer</button>
                                                                    </div>
                                                                </div>

                                                                <div ng-if="question.type !='legend'">
                                                                    <!-- Incase of subquestion wrap questions inside new section -->
                                                                    <div ng-if="question.type=='sub-section'" style="padding:20px">
                                                                        <div ng-repeat="subQuestion in question.questions" style="border:1px solid #eee;margin:5px;padding:10px"
                                                                            class="row" ng-class="{'disabled': subQuestion.disabled}"  ng-if="subQuestion.visible">
                                                                            <div class="col-md-12" style="padding-left:0px;padding-right: 0px;">
                                                                                <strong><span ng-bind="::spaceSubQuestion(subQuestion.number) + subQuestion.title"></span></strong>
                                                                                <div class="pull-right" style="margin-bottom:5px;">
                                                                                    <button ng-if="previousAnswerMapping[subQuestion.key] && !subQuestion.showPrevious" ng-click="subQuestion.showPrevious = !subQuestion.showPrevious" class="btn btn-primary btn-xs">Show previous Answer</button>
                                                                                    <button ng-if="previousAnswerMapping[subQuestion.key] && subQuestion.showPrevious"  ng-click="subQuestion.showPrevious = !subQuestion.showPrevious" class="btn btn-primary btn-xs">Hide previous Answer</button>
                                                                                </div>
                                                                            </div>
                                                                            <div ng-include="'question'" onload="question=subQuestion"></div>
                                                                        </div>
                                                                    </div>
                                                                    <div ng-if="question.type!=='sub-section'">
                                                                        <div ng-include="'question'"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div ng-if="tab.tab==1"  class="section-pane panel panel-default" id="section1" 
                                                    style="margin-bottom:3px!important">
                                                    
                                                    <div class="panel-heading">General information</div>
                                                    <div class="panel-body" style="padding:0px">
                                                        <div ng-include="'contact'"></div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="row">
                        <div class="col-xs-12">
                            <ul class="pagination" id="nrTabs">
                                <li ng-repeat="tab in nr4Tabs" ng-class="{'active': $index==0}" ng-click="setTab($index)">
                                    <a translation-url href="#tab{{$index+1}}" data-toggle="tab" ng-bind="tab.title"></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <pre>
                        {{document|json}}
                    </pre>
                </edit-form>
                <review-form>
                    <view-bch-national-report-4 ng-model="reviewDocument" locale="review.locale" allow-drafts="true"></view-bch-national-report-4>
                </review-form>
            </workflow-arrow-buttons>
        </div>
    </div>

    <div>
        <script type="text/ng-template" id="contact" trados-translation="true">
            <div style="margin:20px">
                <div class="row">
                    <div class="col-xs-12" >
                        <div class="km-control-group" name="languages" required caption=" Please select in which language(s) you wish to submit this record:">
                            <div class="indent">
                                <div km-form-languages required name="languages" ng-model="document.header.languages"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="km-control-group" name="government" required caption="Country">
                            <div afc-autocomplete required name="government" ng-disabled="userHasGovernment()" ng-model="document.government" source="options.countries"
                                filter="genericFilter" mapping="genericMapping" selectbox="true" placeholder="Please select a country..." ng-change="onGovernmentChange(document.government)"></div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12">
                        <div class="km-control-group" name="contact" caption="Contact person submitting the report">											
                            <div document-selector ng-model="document.contact" question="contact"
                                government="document.government" schema="(contact)"></div>			
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="km-control-group" required name="stakeholders" caption="9.	Organizations/stakeholders who were consulted or participated in the preparation of this report">
                            <div km-textbox-ml name="stakeholders" required ng-model="document.stakeholders" locales="document.header.languages"></div>
                        </div>
                    </div>
                </div>
            </div>
        </script>
        <script type="text/ng-template" id="question" trados-translation="true">
            <div style="background-color: #eee;padding:10px 3px" class="col-md-12">
                <div class="col-md-8" style="padding-left: 5px;">
                    <div ng-switch="question.type">
                        <div ng-switch-when="option|term" ng-switch-when-separator="|">

                            <div ng-switch="question.multiple">
                                <div ng-switch-when="false">
                                    <div nr-yes-no question="question" ng-model="document[question.key]" ng-change="updateAnswer(question)"
                                    locales="document.header.languages"></div>
                                </div>
                                <div ng-switch-when="true">
                                    <div km-term-check name="{{question.key}}" ng-change="updateAnswer(question)"
                                    ng-model="multiTermModel[question.key]" terms="question.optionsMapping" binding-type="string[]"></div>
                                </div>
                            </div>

                        </div>
                        <div ng-switch-when="text">
                            <div km-textbox-ml rows=4 name="question.key" 
                                ng-model="document[question.key]" locales="document.header.languages" ></div>
                        </div>
                        <div ng-switch-default>
                            {{question}}
                        </div>
                    </div>
                </div>
                <div class="col-md-4" ng-if="question.showPrevious">
                    <div style="border: 2px solid #fff;padding:5px">
                        <div class="alert alert-info" ng-if="previousAnswerMapping[question.key].showMessage">
                            * Please note that the period covered by this question is different in each reporting format.  
                        </div>
                        <div>
                            <strong ng-bind="previousAnswerMapping[question.key].prevQuestion + '. ' + previousAnswerMapping[question.key].previousQuestion.title"></strong>
                        </div>
                        <div class="well well-sm" ng-if="previousAnswerMapping[question.key].previousQuestion.type!='array' && previousAnswerMapping[question.key].previousQuestion.answer"
                            ng-bind="previousAnswerMapping[question.key].previousQuestion.answer|lstring"></div>
                        <div class="well well-sm" ng-if="previousAnswerMapping[question.key].previousQuestion.type=='array' && previousAnswerMapping[question.key].previousQuestion.answer">
                            <ul class="list">
                                <li ng-repeat="val in previousAnswerMapping[question.key].previousQuestion.answer" ng-bind="val|lstring"></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </script>
    </div>
</div>
