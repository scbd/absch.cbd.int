<div id="editOrganizationDiv">

    <span block-region activate="status=='loading'" ng-if="status=='loading'" update-parent-position="true"></span>
    <div class="registerpage-content">

        <div workflow-arrow-buttons on-review-language-change="onReviewLanguageChange(lang)" document="getCleanDocument()" languages="document.header.languages" hide-timer="false"
            tab="tab" validation-report="validationReport" on-post-close="onPostClose()" on-error="onError(error, errorCode)"
            on-post-publish="onPostPublishOrRequest(data)" on-pre-publish="onPrePublish()" on-pre-save-draft="onPreSaveDraft()"
            on-post-save-draft="onPostSaveDraft(data)" on-post-request="onPostPublishOrRequest(data)" on-pre-request="onPreRequest()"
            data-container="{{container}}" is-dialog="{{isDialog}}" document-type="{{type}}">
            <edit-form>
                <form name="editForm" class="editForm" style="margin-top:10px">
                    <div class="no-shadow bg-white">
                        <legend>{{::('editOrganizationT.generalInfo'|$translate)}}</legend>
                        <div class="row">
                            <div class="col-xs-12" >
                                <div class="km-control-group" name="header.languages" required caption="{{::('editOrganizationT.languageToPublish'|$translate)}}">
                                    <div class="indent">
                                        <div km-form-languages multiple required name="header.languages" ng-model="document.header.languages"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-7 col-xs-12">
                                <div class="km-control-group" name="name" required caption="{{::('editOrganizationT.nameOfTheOrganization'|$translate)}}">
                                    <div class="help-block">{{::('editOrganizationT.nameOfTheOrganizationInfo'|$translate)}}</div>
                                    <div km-textbox-ml name="name" required ng-model="document.name" placeholder="{{::('editOrganizationT.UNEProgramme'|$translate)}}"
                                        locales="document.header.languages"></div>
                                </div>
                            </div>

                            <div class="col-md-5 col-xs-12">
                                <div class="km-control-group" name="acronym" caption="{{::('editOrganizationT.acronym'|$translate)}}">
                                    <div class="help-block">{{::('editOrganizationT.acronymInfo'|$translate)}}</div>
                                    <div km-textbox-ml name="acronym" ng-model="document.acronym"
                                        placeholder="{{::('editOrganizationT.UNEP'|$translate)}}" locales="document.header.languages"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="km-control-group" name="contacts" caption="{{::('editOrganizationT.contactPerson'|$translate)}}">
                                    <div document-selector ng-model="document.contacts" allow-new="true" allow-new-schema="contact"
                                         question="contacts"
                                         on-build-query="onContactQuery(searchText)"
                                         filter="true">
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="no-shadow bg-white">
                        <legend>{{::('editOrganizationT.organizationCoordinates'|$translate)}}</legend>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="km-control-group" name="address" caption="{{::('editOrganizationT.address'|$translate)}}">
                                    <div km-textbox-ml ng-model="document.address" rows="2" placeholder="{{::('editOrganizationT.exampleAddress'|$translate)}}"
                                        locales="document.header.languages"></div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="city" required caption="{{::('editOrganizationT.city'|$translate)}}">
                                    <div km-textbox-ml required name="city" ng-model="document.city" locales="document.header.languages"
                                        placeholder="{{::('editOrganizationT.exampleCity'|$translate)}}"></div>
                                </div>
                            </div>

                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="state" caption="{{::('editOrganizationT.stateProvince'|$translate)}}">
                                    <div km-textbox-ml name="state" ng-model="document.state" locales="document.header.languages"
                                        placeholder="{{::('editOrganizationT.exampleQuebec'|$translate)}}"></div>
                                </div>
                            </div>
                        </div>

                        <div class="row">

                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="postalCode" caption="{{::('editOrganizationT.postalZip'|$translate)}}">
                                    <div km-textbox-ml name="postalCode" ng-model="document.postalCode" locales="document.header.languages"
                                        placeholder="{{::('editOrganizationT.examplePostalCode'|$translate)}}"></div>
                                </div>
                            </div>

                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="country" required caption="{{::('editOrganizationT.country'|$translate)}}">
                                    <div afc-autocomplete name="country" ng-model="document.country" source="options.countries"
                                                mapping="genericMapping" selectbox="true" placeholder="{{::('editOrganizationT.selectCountry'|$translate)}}"
                                                required filter="startsWithFilter" maxmatches="50"></div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="phones" required caption="{{::('editOrganizationT.phoneNumber'|$translate)}}">
                                    <div class="help-info">{{::('editOrganizationT.phoneFormate'|$translate)}}</div>
                                    <div km-inputtext-list required name="phones" ng-model="document.phones"
                                        placeholder="{{::('editOrganizationT.examplePhones'|$translate)}}"></div>
                                </div>
                            </div>

                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="faxes" caption="{{::('editOrganizationT.faxNumber'|$translate)}}">
                                    <div class="help-info">{{::('editOrganizationT.phoneFormate'|$translate)}}</div>
                                    <div km-inputtext-list name="faxes" ng-model="document.faxes" placeholder="{{::('editOrganizationT.examplePhones'|$translate)}}"></div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="emails" required caption="{{::('editOrganizationT.emails'|$translate)}}">
                                    <div km-inputtext-list required name="emails" ng-model="document.emails"
                                        placeholder="{{::('editOrganizationT.exampleEmail'|$translate)}}"></div>
                                </div>
                            </div>

                            <div class="col-md-6 col-xs-12">
                                <div class="km-control-group" name="websites" caption="{{::('editOrganizationT.webAddress'|$translate)}}">
                                    <div km-link name="websites" ng-model="document.websites" allow-link="true"
                                        allow-file="false"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="no-shadow bg-white">
                        <legend>Detailed information</legend>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="km-control-group organization-dropdown" name="organizationType" required caption="{{::('editOrganizationT.typeOfOrganization'|$translate)}}">
                                    <div km-select name="organizationType" required ng-model="document.organizationType"
                                        items="options.organizationTypes()"></div>
                                </div>
                            </div>
                            <div class="col-md-12" ng-show="document.organizationType.identifier=='5B6177DD-5E5E-434E-8CB7-D63D67D5EBED'">
                                <div class="km-control-group" name="organizationTypeName" required caption="Other type of organization">
                                    <div km-textbox-ml name="organizationTypeName" required ng-model="document.organizationType.customValue"
                                        placeholder="{{::('editOrganizationT.exampleCBD'|$translate)}}" locales="document.header.languages"></div>
                                </div>
                            </div>
                        </div>

                        <div ng-if="isBch">

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="km-control-group" name="areasOfWork" caption="{{::('editOrganizationT.areasOfWork'|$translate)}}">                                
                                        <div class="help-block">{{::('editOrganizationT.areasOfWorkInfo'|$translate)}}</div>
                                        <div ng-repeat="areaOfWork in areasOfWork" class="pb-1 d-block input-group">
                                            <div km-textbox-ml name="areaOfWork{{$index}}" class="areas-of-work-input float-start pb-1 trash-text-ml" ng-model="areaOfWork.value" locales="document.header.languages"></div>
                                            <span ng-class="{'disable':areasOfWork.length==1}" class="cursor-pointer input-group-text float-end trash-section"
                                            ng-click="removeItem(areasOfWork, $index)">
                                                <i class="fa fa-trash-o icon"></i>
                                            </span>
                                        </div>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" ng-click="addItem(areasOfWork)"><i class="bi bi-plus"></i>{{::('editOrganizationT.addItem'|$translate)}}</button>
                                    </div>
                                </div>
                            </div>
                            <!-- <div class="row">
                                <div class="col-xs-12">
                                    <div class="km-control-group" required name="cpbThematicAreas" caption="Thematic areas(s)">
                                        <div km-term-check name="cpbThematicAreas" required ng-model="document.cpbThematicAreas" terms="options.cpbThematicAreas()"
                                        binding-type="term[]"></div>
                                    </div>
                                </div>
                            </div> -->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="km-control-group"  name="operationalRegions" caption="{{::('editOrganizationT.operationalRegions'|$translate)}}">
                                        <div km-select multiple required name="operationalRegions" 
                                        ng-model="document.operationalRegions" placeholder="{{::('editOrganizationT.pleaseSelect'|$translate)}}" 
                                        items="options.geographicRegions()"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="km-control-group" name="profile" required caption="{{::('editOrganizationT.profile'|$translate)}}">
                                        <div class="help-block">{{::('editOrganizationT.profileInfo'|$translate)}}</div>
                                        <div km-rich-textbox ng-model="document.profile" rows="2" placeholder="{{::('editOrganizationT.profile'|$translate)}}"
                                        locales="document.header.languages"></div>
                                        <br/>
                                        <div km-link name="profileLink" ng-model="document.profileLink" identifier="document.header.identifier"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="km-control-group" name="linkedOrganizations" caption="{{::('editOrganizationT.linkedOrganizations'|$translate)}}">
                                        <div class="help-block">{{::('editOrganizationT.linkedOrganizationsInfo'|$translate)}}</div>
                                        <div document-selector ng-model="document.linkedOrganizations" allow-new="true" allow-new-schema="organization"
                                             question="linkedOrganizations"
                                             on-build-query="onBuildQuery(searchText)"
                                             filter="true"></div>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                    
                    <div class="no-shadow bg-white">
                        <legend>{{::('editOrganizationT.timeframeConfirmation'|$translate)}}</legend>
                        <div class="help-info">
                            {{::('editOrganizationT.categoryOfInformation'|$translate)}}
                        </div>
                    </div>

                    <div class="no-shadow bg-white">
                        <legend>{{::('editOrganizationT.additionalInformation'|$translate)}}</legend>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="km-control-group" name="address" caption="{{::('editOrganizationT.otherRelevantInformation'|$translate)}}">
                                    <div class="help-block">{{::('editOrganizationT.relevantInformationInfo'|$translate)}}</div>
                                    <div km-rich-textbox ng-model="document.relevantInformation" rows="4" placeholder="" locales="document.header.languages"></div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12">
                                <div class="km-control-group" name="relevantDocuments" caption="{{::('editOrganizationT.relevantDocuments'|$translate)}}">
                                    <div class="help-block">{{::('editOrganizationT.relevantDocumentsInfo'|$translate)}}</div>
                                    <div km-link name="relevantDocuments" ng-model="document.relevantDocuments" allow-link="true" allow-file="true" identifier="document.header.identifier"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="no-shadow bg-white">
                        <legend>{{::('editOrganizationT.notes'|$translate)}}</legend>								
                        <div class="row">
                            <div class="col-md-12">
                                <div class="km-control-group" name="notes">
                                    <span class="help-block">
                                        {{::('editOrganizationT.notesInfos'|$translate)}}
                                    </span>
                                    <div km-notes name="notes" ng-model="document.notes"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </edit-form>
            <review-form>
                <view-organization ng-model="review.document" locale="review.locale"></view-organization>
            </review-form>
        </div>
    </div>

</div>
