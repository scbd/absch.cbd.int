
<div ng-controller="editCheckpointCommunique" class="md-whiteframe-z1">

    <div ng-include="'/app/views/forms/edit/edit_header.html'"></div>

    <div style="padding: 24px;background-color:#FFF;;border-bottom:2px solid #ccc;">

                <span block-region activate="isLoading()" ng-if="isLoading()"></span>
        <div class="registerpage-content">

            <div class="alert alert-error" ng-show="hasError()">
                <strong>Error as occured...</strong>
                <div>{{error}}</div>
            </div>

            <!--<div ng-show="isLoading()">
                <i class="fa fa-spinner fa-spin"></i> Loading...
            </div>-->

            <div ng-show="!isLoading() && status!='hidden'">
                <div workflow-std-buttons document="getCleanDocument()" languages="document.header.languages" hide-timer="false" />

                <div km-document-validation ng-model="validationReport"></div>
                <form class="editForm" name="editForm" style="margin-top:10px">
                    <div ng-show="tab=='edit'" km-tab="edit">
                        <legend name="formInfo" style="display:none"></legend>
                        <section>
                            <legend name="generalInfo">General information</legend>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="control-group">
                                        <div class="km-control-group" name="government" required caption="Country issuing this checkpoint communique">
                                            <div afc-autocomplete required name="government" ng-disabled="userGovernment()" ng-model="document.government" source="options.countries" filter="genericFilter" mapping="genericMapping" selectbox="true" placeholder="Please select a country..."></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="control-group">
                                        <div class="km-control-group" name="title" required caption="Title of this checkpoint communique">
                                            <div km-textbox-ml ng-model="document.title" rows="1" placeholder="Title of this checkpoint communique" locales="document.header.languages"></div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </section>

                        <section>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="control-group">
                                        <div class="km-control-group" name="checkpoint" required caption="Checkpoint/s that collected or received the information">
                                            
                                             <div document-selector ng-model="document.checkpointSelected"
                                                               question="checkpointSelected"
                                                               government="document.government"
                                                               schema="contact"
                                                              ></div>
                                            
                                            
                                            <!--<div km-select multiple name="checkpointSelected" ng-model="document.checkpointSelected" items="options.checkpoints()" placeholder="Please select ..." required></div>-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section>
                            <legend name="certificate">Details of the internationally recognized certificate of compliance</legend>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <span ng-class="{'confidential-text':document.permitNotAvailable}">
                                                <input type="checkbox" name="permitNotAvailable" ng-model="document.permitNotAvailable" watch-items> The internationally recognized certificate of compliance is not available</input>
                                            </span>
                                        </div>
                                        <div class="panel-body panel-body-confidential" ng-class="{'disable':document.permitNotAvailable}">
                                            <div class="km-control-group" style="margin-bottom:20px;" name="permit" required caption="Links to internationally recognized certificates of compliance (IRCC) that relate to this communiqué">
                                                
                                                <div document-selector ng-model="document.permit"
                                                                        question="permit"
                                                                        schema="absPermit"
                                                                        disabled="isPermitNotAvailable()"
                                                                        filter="true"
                                                                        ></div>
                                                              
                                                
                                                <!--<div existing-permit ng-model="document.permit" ng-disabled="isPermitNotAvailable()">-->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="clearfix"></div>
                            <div ng-class="{'disable':!isPermitNotAvailable(), 'bg-white':isPermitNotAvailable() }" class="well no-shadow" style="padding-top:0;padding-bottom:0;">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <h3>Information to be collected or received when the internationally recognized certificate of compliance is not available.</h3>
                                    </div>
                                </div>

                                <legend>Source of the genetic resource</legend>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="control-group">
                                            <div class="km-control-group" name="originCountries" required caption="Source of the genetic resource">
                                                <div km-select required name="originCountries" ng-model="document.originCountries" multiple items="options.countries()" placeholder="Please select a country..."></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <legend>Subject-matter</legend>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="km-control-group" name="subjectMatter" required caption="Subject-matter or genetic resources relevant to the information collected or received">
                                            <div class="help-block">Please provide details on the subject-matter or genetic resources relevant to the information collected or received by the checkpoint. This could include biota at any taxonomic rank, which may carry a taxonomic
                                                name. It may also include a locality of collection of the material. It may also be possible to identify the genetic resource through reference to a voucher specimen or field notes held in an identified archive
                                                or collection. Providing details about the subject matter or genetic resource covered by the permit or its equivalent can provide additional legal certainty.</div>
                                            <div km-rich-textbox name="subjectMatter" rows="6" ng-model="document.subjectMatter" locales="document.header.languages"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="km-control-group" name="optionalSubjectMatterinfo" caption="Optional additional subject matter details">
                                    <span class="help-block">Providing details about the subject matter or genetic resource covered by the permit or its equivalent can provide additional legal certainty</span>
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <div class="km-control-group" name="specimen" caption="Specimen data">
                                                <span class="help-block">Link to a voucher specimen held in an appropriate facility</span>
                                                <div km-link name="specimen" ng-model="document.specimen" allow-link="true" allow-file="false" identifier="document.header.identifier"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <div class="km-control-group" name="taxonomy" caption="Taxonomy">
                                                <span class="help-block">Link to record in external taxonomy database, e.g. GBIF, Catalogue of Life</span>
                                                <div km-link name="taxonomy" ng-model="document.taxonomy" allow-link="true" allow-file="false" identifier="document.header.identifier"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12" ng-class="{'warning':isInvalid('gisFiles')}">
                                            <div class="km-control-group">
                                                <label class="control-label" for="gisFiles">Geographic coordinates</label>
                                                <span class="help-block">Limited to .geojson files (<a href="http://www.geojson.org/" target="_blank">http://www.geojson.org/</a>)</span>
                                                <div km-link required name="gisFiles" ng-model="document.gisFiles" allow-link="false" identifier="document.header.identifier" mime-types="application/json"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <div class="km-control-group" name="keywords" caption="Keywords to describe the subject-matter or genetic resource(s) covered by the permit or its equivalent">
                                                <div km-select multiple required name="keywords" ng-model="document.keywords" items="options.keywords()"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12" ng-show="isOthers()">
                                            <div class="km-control-group" required name="keywordOthers" caption="Other keywords">
                                                <div km-textbox-ml required name="keywordOthers" rows="1" ng-model="document.keywordOthers" locales="document.header.languages"></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div ng-show="document.gisFiles">
                                    <div class="input-prepend input-append">
                                        <input class="input-small" type="text" readonly value="{{document.gisMapCenter.lat | number:6}}">
                                        <span class="add-on">lat</span>
                                    </div>
                                    <div class="input-prepend input-append">
                                        <input class="input-small" type="text" readonly value="{{document.gisMapCenter.lng | number:6}}">
                                        <span class="add-on">long</span>
                                    </div>
                                    <div class="input-prepend input-append">
                                        <input class="input-small" type="text" readonly value="{{document.gisMapCenter.zoom | number:0}}">
                                        <span class="add-on">zoom</span>
                                    </div>
                                </div>
                                <div ng-show="document.gisFiles" class="leaflet" center="document.gisMapCenter" layers="gisLayer"></div>

                                <legend>Evidence of PIC and MAT</legend>

                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="km-control-group" name="referenceOfInformedConsent" caption="Reference or evidence of prior informed consent (PIC)">
                                            <div km-rich-textbox name="referenceOfInformedConsent" rows="4" ng-model="document.referenceOfInformedConsent" locales="document.header.languages"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="km-control-group" name="responsibleAuthorities" caption="Person or entity who granted prior informed consent (PIC)">

                                             <div document-selector ng-model="document.responsibleAuthorities"
                                                                        question="responsibleAuthorities"
                                                                        schema="contact"
                                                                        government="document.government"
                                                                        filter="true"
                                                                        ></div>
                                                                        
                                                                        
                                            <!--<field-embed-contact ng-model="document.responsibleAuthorities" locales="document.header.languages" caption="{{document.responsibleAuthorities ? 'Replace organisation or a contact »' : 'Add an organisation or a contact »'}}"></field-embed-contact>-->
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="km-control-group" name="personeToWhomGranted" caption="Person or entity to whom prior informed consent (PIC) was granted">
                                            <span class="help-block">Please provide the contact details of the person or entity to whom prior informed consent was granted.</span>
                                            <div document-selector ng-model="document.personeToWhomGranted"
                                                                        question="personeToWhomGranted"
                                                                        schema="contact"
                                                                        government="document.government"
                                                                        filter="true"
                                                                        ></div>
                                            <!--<field-embed-contact ng-model="document.personeToWhomGranted" locales="document.header.languages" caption="{{document.personeToWhomGranted ? 'Replace organisation or a contact »' : 'Add an organisation or a contact »'}}"></field-embed-contact>-->

                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="km-control-group" name="referenceOfAgreedTerms" caption="Reference or evidence of establishment of mutually agreed terms (MAT)">
                                            <div km-rich-textbox name="referenceOfAgreedTerms" rows="4" ng-model="document.referenceOfAgreedTerms" locales="document.header.languages"></div>
                                        </div>
                                    </div>
                                </div>
                        </section>
                        <section>

                            <legend>Information on the utilization of the genetic resource(s)</legend>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="km-control-group" required name="description" caption="Short description of the information collected or received by the checkpoint relevant to the utilization of genetic resources, including  the type of use">
                                        <div km-rich-textbox name="description" rows="4" ng-model="document.description" locales="document.header.languages"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="km-control-group" required name="geneticRessourceUsers" caption=" Person or entity making information available to the checkpoint on the utilization of the genetic resource ">
                                        <div document-selector ng-model="document.geneticRessourceUsers"
                                                                        question="geneticRessourceUsers"
                                                                        schema="contact"
                                                                        government="document.government"
                                                                        filter="true"
                                                                        ></div>
                                                                        
                                        
                                        <!--<field-embed-contact multiple ng-model="document.geneticRessourceUsers" name="geneticRessourceUsers" locales="document.header.languages" caption="Add an organisation or a contact »"></field-embed-contact>-->

                                    </div>
                                </div>
                            </div>

                            <label>Date on which the information was collected or received at the checkpoint</label>
                            <div class="row" style="margin-bottom:20px;">
                                <div class="col-xs-4">
                                    <div km-date placeholder="YYYY-MM-DD" required name="date" ng-model="document.date"></div>
                                </div>
                                <div class="col-xs-1 bg-grey">
                                    <div style="font-size:16px;font-weight:bold;padding: 6px;text-align: center;" name="dateOR" caption="OR">OR</div>
                                </div>
                                <div class="col-xs-3 text-right">
                                    <div km-date placeholder="FROM" required name="dateFrom" ng-model="document.dateFrom"></div>
                                </div>
                                <div class="col-xs-3  text-right">
                                    <div km-date placeholder="TO" required name="dateTo" ng-model="document.dateTo"></div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="km-control-group" name="informationDocuments" caption="Upload relevant document">
                                        <div km-link name="informationDocuments" ng-model="document.informationDocuments" identifier="document.header.identifier"></div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                        <section>

                            <legend>Additional Information</legend>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="km-control-group" name="relevantInformation" caption="Additional Information">
                                        <div class="help-block">Please use this field to provide any other relevant information that may not have been addressed elsewhere in the record.</div>
                                        <div km-rich-textbox name="relevantInformation" rows="6" ng-model="document.relevantInformation" locales="document.header.languages"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="km-control-group" name="relevantDocuments" caption="Other relevant website address or attached documents">
                                        <div km-link name="relevantDocuments" ng-model="document.relevantDocuments" identifier="document.header.identifier"></div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section>
                            <legend>Notes</legend>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="km-control-group" name="notes">
                                        <div class="help-block">The “Notes” field is for your personal notes or comments and will be hidden when viewing the record. This field is not meant to be used for confidential information.</div>
                                        <textarea class="form-control" rows="4" name="notes" ng-model="document.notes"></textarea>
                                    </div>
                                </div>
                            </div>
                        </section>
                    
                </form>

                <div ng-show="tab=='review'" km-tab="review">

                    <div class="btn-group" ng-show="reviewDocument.header.languages.length>1">
                        <input type="button" class="btn" ng-class="{'active' : review.locale==locale, 'btn-info' : review.locale==locale}" ng-repeat="locale in document.header.languages" ng-click="$parent.review.locale = locale" value="{{locale | uppercase}}" />
                    </div>
                    <div class="view-abs-checkpoint-communique" ng-model="reviewDocument" locale="review.locale" allow-drafts="true" show-pdf="false"></div>
                </div>

            </div>
        </div>
    </div>
</div>
